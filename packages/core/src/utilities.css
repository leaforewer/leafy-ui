@utility flex-center {
  @apply flex items-center justify-center;
}

@utility leaf-stagger {
  --stagger-delay: 100ms;
  --anim: leaf-fade-up;
  --stagger-duration: 0.5s;
  --stagger-ease: var(--ease-standard);
  --stagger-start: 0s;

  & > * {
    opacity: 0;
    animation: var(--anim) var(--stagger-duration) var(--stagger-ease) forwards;
    animation-delay: calc(var(--i, 0) * var(--stagger-delay));
  }

  &.leaf-anim-slide-in {
    --anim: leaf-fade-slide-in;
  }

  &.leaf-anim-scale-in {
    --anim: leaf-scale-in;
  }
}

@utility pop-btn {
  --btn-bg: var(--color-surface);
  --btn-fg: var(--color-fg);
  --btn-border: var(--color-border);
  --btn-shadow: var(--color-shadow);

  @apply inline-block rounded border-2 text-[var(--btn-fg)] py-1.5 px-4 h-max cursor-pointer;

  background-color: var(--btn-bg);
  border-color: var(--btn-border);
  box-shadow: 4px 4px 0 0 var(--btn-shadow);
  transition:
    transform 100ms ease-out,
    box-shadow 100ms ease-out;

  &:hover:not(:disabled):not(.disabled) {
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 0 var(--btn-shadow);
  }

  &:active:not(:disabled):not(.disabled),
  &.active:not(:disabled):not(.disabled) {
    transform: translate(4px, 4px);
    box-shadow: 0 0 0 0 var(--btn-shadow);
  }

  &:disabled,
  &.disabled {
    --btn-bg: #f3f4f6;
    --btn-border: #d1d5db;
    --btn-shadow: #9ca3af;
    @apply text-neutral-400 cursor-default;
  }
}

@utility btn {
  --btn-bg: var(--color-surface);
  --btn-fg: var(--color-fg);
  --btn-p: 1rem;
  --size: calc(var(--spacing, 0.25rem) * 10);
  @apply inline-flex relative overflow-hidden rounded-md gap-1 justify-center items-center shrink-0 flex-nowrap cursor-pointer text-center align-middle select-none shadow transition duration-200 ease-standard;

  background-color: var(--btn-bg);
  color: var(--btn-fg);
  height: var(--size);
  padding: 0 var(--btn-p);
  font-size: var(--font-size, 0.875rem);

  &::before {
    content: "";
    width: 125%;
    height: 200%;
    position: absolute;
    background-color: white;
    border-radius: 50%;
    left: -126%;
    top: 0;
    transition-duration: 350ms;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-property: transform, border-radius;
    mix-blend-mode: difference;
  }

  &:hover {
    background-color: color-mix(in oklab, var(--btn-bg), #000 7%);

    &::before {
      transform: translate(90%, -45%);
      border-radius: 0;
    }

    @media (prefers-color-scheme: dark) {
      background-color: color-mix(in oklab, var(--btn-bg), #fff 7%);
    }
  }

  &:active {
    @apply translate-0.5;
    background-color: color-mix(in oklab, var(--btn-bg), #000 5%);

    @media (prefers-color-scheme: dark) {
      background-color: color-mix(in oklab, var(--btn-bg), #fff 5%);
    }
  }

  &.btn-xs {
    --font-size: 0.6875rem;
    --btn-p: 0.675rem;
    --size: calc(var(--spacing, 0.25rem) * 7);
  }

  &.btn-sm {
    --font-size: 0.75rem;
    --btn-p: 0.75rem;
    --size: calc(var(--spacing, 0.25rem) * 8);
  }

  &.btn-lg {
    --font-size: 1.125rem;
    --btn-p: 1.25rem;
    --size: calc(var(--spacing, 0.25rem) * 12);
  }

  &.btn-xl {
    --font-size: 1.375rem;
    --btn-p: 1.5rem;
    --size: calc(var(--spacing, 0.25rem) * 14);
  }
}

@utility btn-* {
  --btn-bg: --value(--color-*, [color]);
}

@layer utilities {
  *:has(.pop-btn.bordered) {
    isolation: isolate;
  }

  .leafy-container {
    @apply max-w-[calc(100%_-_1rem)] mx-auto lg:max-w-7xl;
  }

  .leafy-btn {
    @apply flex-center rounded-lg bg-neutral-800 text-white px-4 py-2 hover:scale-110 transition-all;
  }

  .leafy-btn-primary {
    @apply bg-[--color-surface] text-[--color-fg] hover:brightness-110;
  }

  .leaf-animated-letters {
    --anim: leaf-fade-in;

    & > .letter {
      display: inline;
      opacity: 0;
      animation: var(--anim) 0.4s var(--ease-standard) forwards;
      animation-delay: calc(var(--i, 0) * 0.05s);
    }
  }

  .reveal-up {
    --reveal-anim: leaf-reveal-up;
  }

  .reveal-left {
    --reveal-anim: leaf-slide-in;
  }

  .reveal-fade {
    --reveal-anim: leaf-fade-in;
  }

  @supports (animation-timeline: view()) {
    .reveal-up,
    .reveal-left,
    .reveal-fade {
      --reveal-delay: 100ms;
      opacity: 0;
      animation: var(--reveal-anim) 1s var(--ease-standard) both;
      animation-timeline: view();
      animation-range: entry 0% cover 40%;
      animation-delay: var(--reveal-delay);
    }
  }
}
